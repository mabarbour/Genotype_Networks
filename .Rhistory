labels = c("(A)","(B)","(C)"))
D.gallsize <- data.frame(x = label.x.pos, y = label.y.gallsize, labels = "(D)")
ABC.domptoids <- data.frame(x = rep(label.x.pos,3), y = label.y.ptoids,
Parasitoid = c("Platygaster", "Mesopolobus", "Torymus"),
labels = c("(A)","(B)","(C)"))
EFG.domptoids <- data.frame(x = rep(label.x.pos,3), y = rep(label.y.ptoids,3),
Parasitoid = c("Platygaster", "Mesopolobus", "Torymus"),
labels = c("(E)","(F)","(G)"))
D.ptism <- data.frame(x = label.x.pos, y = label.y.ptism, labels = "(D)")
H.ptism <- data.frame(x = label.x.pos, y = label.y.ptism, labels = "(H)")
A.linkabund <- data.frame(x = 0.5, y = 10, labels = "(A)")
B.ptism <- data.frame(x = 4.25, y = label.y.ptism, labels = "(B)")
AB.ptism <- data.frame(x = rep(4.25,2), y = rep(1,2),
labels = c("(A)","(B)"), cut.vLG_abund = c("Low leaf gall abundance (1 - 4 per branch)", "High leaf gall abundance (5 - 22 per branch)"))
#point.size <- 6
line.widths <- 2 # for link plots (3 for full page plots)
## create color-blind friendly palette with grey (taken from http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/)
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
## make integer breaks for facet plotting in ggplot
library("scales")
integer_breaks <- function(n = 5, ...) {
breaker <- pretty_breaks(n, ...)
function(x) {
breaks <- breaker(x)
breaks[breaks == floor(breaks)]
}
}
## change Genotype * to C for plotting aesthetics
levels(tree_level_interaxn_all_plants_traits_size$Genotype)[1] <- "C"
source('~/Documents/Genotype_Networks/Rscripts/network_management_tree_level.R')
source('~/Documents/miscellaneous_R/ggplot_themes.R')
source('~/Documents/ggnet/bipartite_plot_info.R')
source('~/Documents/ggnet/tripartite_plot_info.R')
require(ggplot2)
#devtools::install_github("hadley/ggplot2")
require(gridExtra)
require(dplyr)
require(tidyr)
require(vegan)
## for an unknown reason, ggsave needs to be modified for me to save my arrangeGrob object ----
#ggsave <- ggplot2::ggsave; body(ggsave) <- body(ggplot2::ggsave)[-2]
## create theme for figures ----
theme_links <- theme_bw() +
theme(axis.title.x = element_text(size = 11, vjust = -0.25), # size = 12
axis.title.y = element_text(size = 11, vjust = 1.25), # size = 12
axis.text.y = element_text(size = 9),#10
axis.text.x = element_text(size = 8), #12
strip.text = element_text(size = 9), #9
panel.grid = element_blank(),
legend.position = "none")
point.size.range <- c(1,3) #c(1,5)
point.size.range.ptism <- c(0.25,3)#c(1,3.5)
label.x.pos <- 1.5 #2
label.y.galls <- c(20,16,2.6) #23 # 21
label.y.gallsize <- 14 #13.75
label.y.ptoids <- c(8.1,3.65,2.75) #9.5 #9.75
label.y.ptism <- 1
label.size <- 3 # 3
ABCD.allgalls <- data.frame(x = rep(label.x.pos,4), y = rep(label.y.galls,4),
variable = c("Leaf gall", "Apical-stem gall",
"Bud gall", "Mid-stem gall"),
labels = c("(A)","(B)","(C)","(D)"))
ABC.domgalls <- data.frame(x = rep(label.x.pos,3), y = label.y.galls,#3),
variable = c("Leaf gall","Bud gall", "Apical-stem gall"),
labels = c("(A)","(B)","(C)"))
D.gallsize <- data.frame(x = label.x.pos, y = label.y.gallsize, labels = "(D)")
ABC.domptoids <- data.frame(x = rep(label.x.pos,3), y = label.y.ptoids,
Parasitoid = c("Platygaster", "Mesopolobus", "Torymus"),
labels = c("(A)","(B)","(C)"))
EFG.domptoids <- data.frame(x = rep(label.x.pos,3), y = rep(label.y.ptoids,3),
Parasitoid = c("Platygaster", "Mesopolobus", "Torymus"),
labels = c("(E)","(F)","(G)"))
D.ptism <- data.frame(x = label.x.pos, y = label.y.ptism, labels = "(D)")
H.ptism <- data.frame(x = label.x.pos, y = label.y.ptism, labels = "(H)")
A.linkabund <- data.frame(x = 0.5, y = 10, labels = "(A)")
B.ptism <- data.frame(x = 4.25, y = label.y.ptism, labels = "(B)")
AB.ptism <- data.frame(x = rep(4.25,2), y = rep(1,2),
labels = c("(A)","(B)"), cut.vLG_abund = c("Low leaf gall abundance (1 - 4 per branch)", "High leaf gall abundance (5 - 22 per branch)"))
#point.size <- 6
line.widths <- 2 # for link plots (3 for full page plots)
## create color-blind friendly palette with grey (taken from http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/)
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
## make integer breaks for facet plotting in ggplot
library("scales")
integer_breaks <- function(n = 5, ...) {
breaker <- pretty_breaks(n, ...)
function(x) {
breaks <- breaker(x)
breaks[breaks == floor(breaks)]
}
}
## change Genotype * to C for plotting aesthetics
levels(tree_level_interaxn_all_plants_traits_size$Genotype)[1] <- "C"
## load required libraries
#require(visreg)
require(ggplot2)
require(grid)
require(dplyr)
require(tidyr)
## upload results from full simulation
all.measures <- read.csv("~/Documents/Genotype_Networks/data/food web complexity simulation 50 reps of 200 sims 4 reps.csv")
dim(all.measures)[1] # 216,102 unique simulations. 250,00 simulations originally run
## upload results from monoculture simulations
mono1 <- read.csv("~/Documents/Genotype_Networks/data/food web complexity simulation 1000 monosims 1 reps.csv")
mono2 <- read.csv("~/Documents/Genotype_Networks/data/food web complexity simulation 1000 monosims 2 reps.csv")
mono3 <- read.csv("~/Documents/Genotype_Networks/data/food web complexity simulation 1000 monosims 3 reps.csv")
mono4 <- read.csv("~/Documents/Genotype_Networks/data/food web complexity simulation 1000 monosims 4 reps.csv")
monos <- bind_rows(list(mono1, mono2, mono3, mono4)) #%>%
ggplot(monos, aes(x = plants.sampled, y = total_complexity, group = sim.number)) +
#geom_jitter(shape = 1, color = "grey", position = position_jitter(width = 0.15, height = NULL)) +
stat_summary(fun.y = mean, geom = "point", color = "grey", size = 2, shape = 1) #+
#geom_smooth(method = "lm", formula = y ~ log(x), color = "black")
monos.summary <- monos %>% group_by(sim.number, plants.sampled) %>% summarise(total_complexity.mean = mean(total_complexity, na.rm = TRUE))
monos.summary.plot <- monos.summary %>% group_by(plants.sampled) %>%
summarise(total_complexity.mean = mean(total_complexity.mean))
## summary stats from full simulation
alpha.summary <- all.measures %>%
filter(genotypes.sampled == 1) %>%
group_by(df.sim.number) %>%
summarise(alpha.mean = mean(total_complexity, na.rm = TRUE),
alpha.min = 1) %>% # minimum value that food-web complexity can take
mutate(alpha.contrib = alpha.mean - alpha.min)
gamma.summary <- all.measures %>%
filter(genotypes.sampled == 25) %>%
group_by(df.sim.number) %>%
summarise(gamma = mean(total_complexity))
beta.summary <- left_join(alpha.summary, gamma.summary, by = "df.sim.number") %>%
mutate(beta.contrib = gamma - alpha.mean,
total.contrib = gamma - alpha.min,
beta.prop.contrib = beta.contrib/total.contrib,
alpha.prop.contrib = alpha.contrib/total.contrib,
beta.magnitude = gamma/alpha.mean,
gamma.magnitude = gamma/alpha.min)
final.summary <- beta.summary %>%
filter(alpha.min > 0) %>%
summarise_each(funs(mean, sd)) %>%
select(-df.sim.number_mean, -df.sim.number_sd) %>%
as.matrix(.)
## calculate difference between maximum monoculture and 25-genotype polyculture for all different data sets of the simulation
agg.prop <- all.measures %>%
filter(genotypes.sampled %in% c(1,25)) %>%
group_by(df.sim.number, genotypes.sampled) %>%
summarise(max.complex = max(total_complexity, na.rm = TRUE)) %>%
spread(genotypes.sampled, max.complex)
diff.25.max1 <- agg.prop$'25' - agg.prop$'1'
summary(diff.25.max1)
hist(diff.25.max1)
## calculate the mean food web complexity for the different levels of genetic variation
web.measures.summary <- all.measures %>% # all.measures
group_by(df.sim.number, genotypes.sampled) %>%
summarise(mean.complexity = mean(total_complexity, na.rm = TRUE))
mean.complexity.25 <- mean(filter(web.measures.summary, genotypes.sampled == 25)$mean.complexity)
web.measures.overall <- web.measures.summary %>%
group_by(genotypes.sampled) %>%
summarise(mean.complexity = mean(mean.complexity))
## identify starting values for Micheaelis-Menton function with a linear model. Subtracting 1 shifts the function to the right. I did this because the starting value is 1 genotype. Slope and intercept will correspond to the parameters a and d, respectively for the non-linear model
b <-2 # increased progressively from a value of 1 to maximize R2. 2 without switching gall_ptoid LD NA to zero.
full.init.lm <- lm(mean.complexity ~ I((genotypes.sampled - 1)/(genotypes.sampled - 1 + b)), web.measures.summary)
summary(full.init.lm) # new R2 = 0.9573
## non-linear model
full.nls <- nls(mean.complexity ~ a*(genotypes.sampled - 1)/(genotypes.sampled - 1 + b) + d, web.measures.summary,
start = list(a = coef(full.init.lm)[2],
b = b,
d = coef(full.init.lm)[1]))
summary(full.nls)
full.nls.predict.df <- data.frame(mean.complexity = predict(full.nls, newdata = data.frame(genotypes.sampled = 1:25)),
genotypes.sampled = 1:25)
max.full.nls <- max(predict(full.nls, newdata = data.frame(genotypes.sampled = 1:25))) # predict food-web complexity of 2.2
(max.full.nls - mean.complexity.25)/mean.complexity.25 # deviated by less than a 10th of 1% of observed value (over predicted)
pred.full.nls.100genos <- max(predict(full.nls, newdata = data.frame(genotypes.sampled = 1:100))) # hypothetical prediction of complexity of 100-genotype food-web
full.nls.lm <- lm(mean.complexity ~ I((genotypes.sampled - 1)/(genotypes.sampled - 1 + coef(full.nls)[2])), web.measures.summary)
summary(full.nls.lm) # R2 = 0.96
plot(full.nls.lm) # residuals look good
# log-linear
full.lm.loglin <- lm(mean.complexity ~ log(genotypes.sampled), web.measures.summary)
summary(full.lm.loglin)
max(predict(full.lm.loglin, newdata = data.frame(genotypes.sampled = 1:25)))
(2.262 - 2.209)/2.209
visreg::visreg(full.lm.loglin)
plot(full.lm.loglin) # horrible residuals
exp(max(predict(full.lm.loglog, newdata = data.frame(genotypes.sampled = 1:25))))
(2.277 - 2.209)/2.209
visreg::visreg(full.lm.loglog)
plot(full.lm.loglog) # horrible residuals again
## non-linear model based on first 4 data points. Used values from full non-linear model as initial values in this model
full.nls.4pts <- nls(mean.complexity ~ a*(genotypes.sampled - 1)/(genotypes.sampled - 1 + b) + d,
filter(web.measures.summary, genotypes.sampled < 5),
start = list(a = coef(full.nls)["a"],
b = coef(full.nls)["b"],
d = coef(full.nls)["d"]))
summary(full.nls.4pts)
max.4pts.nls <- max(predict(full.nls.4pts, newdata = data.frame(genotypes.sampled = 1:25)))
(max.4pts.nls - mean.complexity.25)/max.4pts.nls # error is still less than 10th of 1%. used to overestimates by about 2%
pred.4pts.nls.100genos <- max(predict(full.nls.4pts, newdata = data.frame(genotypes.sampled = 1:100)))
#full.nls.lm.4pts <- lm(mean.complexity ~ I((genotypes.sampled - 1)/(genotypes.sampled - 1 + coef(full.nls.4pts)[2])), filter(web.measures.summary, genotypes.sampled < 5))
#summary(full.nls.lm.4pts) # note that this R2 doesn't mean much, because it is being fit to a smaller dataset.
## find initial starting values for monoculture samples using a linear model
b <- 4 # progressively increased from 1 to maximize R2. Used to be 4
monos.init.lm <- lm(total_complexity.mean ~ I((plants.sampled - 1)/(plants.sampled - 1 + b)), monos.summary)
summary(monos.init.lm) # R2 = 0.8778
## non-linear model for monocultures. Used the coefficients from the full model as initial starting values so that the methods were comparable with the subsampling of 4 genotypes. Note however, that the coefficient estimates were robust to different starting value (e.g. based on prior iterations with linear model)
mono.nls <- nls(total_complexity.mean ~ a*(plants.sampled - 1)/(plants.sampled - 1 + b) + d, monos.summary,
start = list(a = coef(full.nls)["a"],
b = coef(full.nls)["b"],
d = coef(full.nls)["d"]))
#list(a = coef(monos.init.lm)[2],
#    b = b,
#   d = coef(monos.init.lm)[1]))
summary(mono.nls)
monos.nls.predict <- data.frame(total_complexity = predict(mono.nls, newdata = data.frame(plants.sampled = 1:100)),
plants.sampled = 1:100)
max.mono.nls <- max(monos.nls.predict$total_complexity) # predict food-web complexity of 1.84 at 100 plants (comparable to 25 genotypes)
mono.nls.lm <- lm(total_complexity.mean ~ I((plants.sampled - 1)/(plants.sampled - 1 + coef(mono.nls)[2])), monos.summary)
summary(mono.nls.lm)
## log-log
mono.loglog.lm <- lm(log(total_complexity.mean) ~ log(plants.sampled), monos.summary)
summary(mono.loglog.lm)
exp(predict(mono.loglog.lm, newdata = data.frame(plants.sampled = 1:100))) # 2.45
## log-linear
mono.loglin.lm <- lm(total_complexity.mean ~ log(plants.sampled), monos.summary)
summary(mono.loglin.lm)
predict(mono.loglin.lm, newdata = data.frame(plants.sampled = 1:100)) # 2.17
## magnitude of increase in food-web complexity due to genotypes hosting distinct sets of trophic interactions
mean.complexity.25/max.mono.nls # 20% increase in food-web complexity.
## additive partition of food-web complexity
gamma.contrib <- mean.complexity.25 - 1 # subtracted 1 because this is the minimum value of food-web complexity for including in our simulation
alpha.contrib <- final.summary[ ,"alpha.mean_mean"] - 1
beta.area.contrib <- max.mono.nls - final.summary[ ,"alpha.mean_mean"]
beta.genetic.contrib <- mean.complexity.25 - max.mono.nls
beta.genetic.contrib/gamma.contrib
beta.area.contrib/gamma.contrib
alpha.contrib/gamma.contrib
# setup multipanel plot for combining ggplot and base graphics (ordination from "link_composition_plots")
## plot the relationship between genetic variation and total food web complexity (weighted linkage density)
total.labels <- paste(c(" ",1,5,10,15,20,25),
c("(1) "," (4)","(20)","(40)","(60)","(80)","(100)"), sep = "\n")
total <- ggplot(web.measures.summary,#all.measures,
aes(x = genotypes.sampled,
y = mean.complexity,# total_complexity,
group = genotypes.sampled)) +
#stat_summary(fun.y = mean, geom = "point", color = "grey",
#            shape = 1, size = 1.5) +
geom_jitter(color = "grey", shape = 1, position = position_jitter(width = 0.25, height = NULL), size = 1) +
stat_summary(fun.y = mean, geom = "point", color = "steelblue",
shape = 20, size = 3) +
#geom_line(data = full.nls.predict.df, aes(x = genotypes.sampled, y = mean.complexity),
# size = 1,
# color = "steelblue", inherit.aes = FALSE) +
#geom_boxplot(aes(group = genotypes.sampled),
#           notch = TRUE, outlier.shape = 1,
#          outlier.colour = "grey", fill = "steelblue") +
#geom_jitter(shape = 1,
#           color = "grey",
#          position = position_jitter(width = 0.25, height = NULL),
#         size = 1) +
#stat_summary(fun.y = mean, geom = "point", color = "steelblue", size = 3) +
#geom_boxplot(data = monos.summary,
#          aes(x = plants.sampled/4,
#             y = total_complexity.mean,
#            group = plants.sampled),
#       color = "black",
#      outlier.shape = NA,
#outlier.colour = "black",
#     inherit.aes = FALSE) +
geom_point(data = monos.summary.plot,
aes(x = plants.sampled/4,
y = total_complexity.mean),
color = "black",
inherit.aes = FALSE) +
geom_line(data = monos.nls.predict,
aes(x = plants.sampled/4, y = total_complexity),
linetype = "dashed",
color = "black",
inherit.aes = FALSE) +
xlab("No. of willow genotypes (no. of plants)") +
ylab(bquote('Food-web complexity ('*italic(LD[q])*')')) +
scale_x_continuous(limits = c(0.1,25.5),
breaks = c(0.25,1,5,10,15,20,25),
labels = total.labels) +
scale_y_continuous(limits = c(1,2.45), #c(1,2.4)
breaks = seq(1, 2.25, by = 0.25)) +
theme_bw() +
theme(axis.text.y = element_text(size = 9),
axis.text.x = element_text(size = 6),#9
axis.title.x = element_text(size = 11, vjust = 0.1),
axis.title.y = element_text(size = 11, vjust = 0.5),
panel.grid = element_blank())
total
## tidy up full link composition data for ordination of entire food web ----
full.links.df <- as.data.frame(tree_level_interaxn_all_plants_traits_size) %>%
select(Genotype,
vLG_abund, aSG_abund, rG_abund, SG_abund, # willow-gall links
vLG_Platy, vLG_Tory, vLG_Mesopol, vLG_Eulo, vLG_Mymarid, # vLG-ptoid links
rG_Platy, rG_Tory, rG_Mesopol, rG_Eulo, rG_Lestodip, # rG-ptoid links
SG_Platy, aSG_Tory) # other gall-ptoid links
all.links <- names(full.links.df)[-1]
trees.with.links <- which(rowSums(full.links.df[ ,all.links]) > 0)
table(full.links.df$Genotype[trees.with.links]) # J, N, and U have 2 or less replicates with any links.
full.links.df.sub <- filter(full.links.df[trees.with.links, ],
Genotype != "J",
Genotype != "N",
Genotype != "U")
## analysis of dissimilarity
adonis(full.links.df.sub[ ,all.links] ~ Genotype, data = full.links.df.sub, distance = "bray")
anova(betadisper(vegdist(full.links.df.sub[ ,all.links], "bray"), full.links.df.sub$Genotype)) # no difference in betadiversity
full.links.meandist <- meandist(vegdist(full.links.df.sub[ ,all.links], "bray"), full.links.df.sub$Genotype)
summary(full.links.meandist)
mean(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)]) # eseentially matches summary, may be slightly different due to weightings.
max(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)])
min(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)])
## perform RDA analyses and extract centroid scores for plotting.
cap.geno <- capscale(full.links.df.sub[ ,all.links] ~ Genotype,
data = full.links.df.sub,
distance = "bray")
summary(cap.geno)
centroids.cap.geno <- data.frame(scores(cap.geno, choices = c(1,2), display = "cn"))
rownames(centroids.cap.geno) <- levels(full.links.df$Genotype)[-c(10,14,21)] # remove Genotypes J, N, and U
centroids.cap.geno$Genotype <- rownames(centroids.cap.geno)
sites.cap.geno <- data.frame(scores(cap.geno, choices = c(1,2), display = "sites"), droplevels(full.links.df.sub$Genotype))
colnames(sites.cap.geno)[3] <- "Genotype"
plot.new() # need to call this for ordiellipse function to work
ellip <- ordiellipse(cap.geno, groups = full.links.df.sub$Genotype,
kind = "se", draw = "polygon", #Note that by specificying the kind of ellipse in ordiellipse will make sure the type of ellipse you want is drawn (e.g. standard error or 95% CI)
col= "gray50", #"gainsboro",
border = NA, label = T)
## ggplot2 ordination plot ----
# function for ellipses: taken from the excellent stackoverflow Q+A: http://stackoverflow.com/questions/13794419/plotting-ordiellipse-function-from-vegan-package-onto-nmds-plot-created-in-ggplot2. Another useful reference was https://oliviarata.wordpress.com/2014/04/17/ordinations-in-ggplot2/
veganCovEllipse <- function (cov, center = c(0, 0), scale = 1, npoints = 100)
{
theta <- (0:npoints) * 2 * pi/npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
# data for ellipse.
df_ell.cap.geno <- data.frame() #sets up a data frame before running the function.
for(g in levels(sites.cap.geno$Genotype)){
df_ell.cap.geno <- rbind(df_ell.cap.geno,
cbind(as.data.frame(
with(sites.cap.geno[sites.cap.geno$Genotype == g, ],
veganCovEllipse(ellip[[g]]$cov, ellip[[g]]$center, ellip[[g]]$scale))), Genotype = g))
}
#B.compliment <- data.frame(x = -2.925, y = 2.4, labels = "(B)") # plot label
compliment <- ggplot(data = df_ell.cap.geno, aes(x = CAP1, y = CAP2, group = Genotype)) +
coord_fixed(ratio = 1) + #, xlim= c(-3.3,3.3)) + #xlim = c(-3,3.2)
geom_polygon(color = NA, fill = "gray50", alpha = 0.5) + # didn't use stat_ellipse because I wanted to plot standard errors instead of 95% confidence intervals
geom_text(data = centroids.cap.geno,
aes(x = CAP1, y = CAP2, label = Genotype), size = 2) +
#scale_x_continuous(limits = c(-3,2)) +
#geom_text(data = B.compliment, aes(x = x, y = y, label = labels),
#          inherit.aes = FALSE, size = 4) +
theme_bw() +
theme(axis.text.y = element_text(size = 6),#10
axis.text.x = element_text(size = 6),#10
axis.title.x = element_text(size = 8, vjust = 0.75),#vjust = 0.1,
axis.title.y = element_text(size = 8, vjust = 0.25),#vjust = 0.5,
panel.grid = element_blank(),
plot.margin = unit(c(0,0,0,0), "in"))
# adjust plot.margin
vp <- viewport(width = 0.35, height = 0.35, x = 0.75, y = 0.32) #viewport(width = 0.4, height = 0.4, x = 0.7, y = 0.35)
tiff("~/Documents/Genotype_Networks/figures/fig_6_complexity_complimentarity.tif", width = 3.42, height = 4, units = "in", res = 600)
print(total)
print(compliment, vp = vp)
dev.off() # turn off png device
install.packages(c("gridExtra","vegan"))
install.packages(c("gridExtra", "vegan"))
require(ggplot2)
#devtools::install_github("hadley/ggplot2")
require(gridExtra)
require(dplyr)
require(tidyr)
require(vegan)
## tidy up full link composition data for ordination of entire food web ----
full.links.df <- as.data.frame(tree_level_interaxn_all_plants_traits_size) %>%
select(Genotype,
vLG_abund, aSG_abund, rG_abund, SG_abund, # willow-gall links
vLG_Platy, vLG_Tory, vLG_Mesopol, vLG_Eulo, vLG_Mymarid, # vLG-ptoid links
rG_Platy, rG_Tory, rG_Mesopol, rG_Eulo, rG_Lestodip, # rG-ptoid links
SG_Platy, aSG_Tory) # other gall-ptoid links
all.links <- names(full.links.df)[-1]
trees.with.links <- which(rowSums(full.links.df[ ,all.links]) > 0)
table(full.links.df$Genotype[trees.with.links]) # J, N, and U have 2 or less replicates with any links.
full.links.df.sub <- filter(full.links.df[trees.with.links, ],
Genotype != "J",
Genotype != "N",
Genotype != "U")
## analysis of dissimilarity
adonis(full.links.df.sub[ ,all.links] ~ Genotype, data = full.links.df.sub, distance = "bray")
anova(betadisper(vegdist(full.links.df.sub[ ,all.links], "bray"), full.links.df.sub$Genotype)) # no difference in betadiversity
full.links.meandist <- meandist(vegdist(full.links.df.sub[ ,all.links], "bray"), full.links.df.sub$Genotype)
summary(full.links.meandist)
mean(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)]) # eseentially matches summary, may be slightly different due to weightings.
max(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)])
min(full.links.meandist[lower.tri(full.links.meandist, diag = TRUE)])
## perform RDA analyses and extract centroid scores for plotting.
cap.geno <- capscale(full.links.df.sub[ ,all.links] ~ Genotype,
data = full.links.df.sub,
distance = "bray")
summary(cap.geno)
centroids.cap.geno <- data.frame(scores(cap.geno, choices = c(1,2), display = "cn"))
rownames(centroids.cap.geno) <- levels(full.links.df$Genotype)[-c(10,14,21)] # remove Genotypes J, N, and U
centroids.cap.geno$Genotype <- rownames(centroids.cap.geno)
sites.cap.geno <- data.frame(scores(cap.geno, choices = c(1,2), display = "sites"), droplevels(full.links.df.sub$Genotype))
colnames(sites.cap.geno)[3] <- "Genotype"
plot.new() # need to call this for ordiellipse function to work
ellip <- ordiellipse(cap.geno, groups = full.links.df.sub$Genotype,
kind = "se", draw = "polygon", #Note that by specificying the kind of ellipse in ordiellipse will make sure the type of ellipse you want is drawn (e.g. standard error or 95% CI)
col= "gray50", #"gainsboro",
border = NA, label = T)
## ggplot2 ordination plot ----
# function for ellipses: taken from the excellent stackoverflow Q+A: http://stackoverflow.com/questions/13794419/plotting-ordiellipse-function-from-vegan-package-onto-nmds-plot-created-in-ggplot2. Another useful reference was https://oliviarata.wordpress.com/2014/04/17/ordinations-in-ggplot2/
veganCovEllipse <- function (cov, center = c(0, 0), scale = 1, npoints = 100)
{
theta <- (0:npoints) * 2 * pi/npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
# data for ellipse.
df_ell.cap.geno <- data.frame() #sets up a data frame before running the function.
for(g in levels(sites.cap.geno$Genotype)){
df_ell.cap.geno <- rbind(df_ell.cap.geno,
cbind(as.data.frame(
with(sites.cap.geno[sites.cap.geno$Genotype == g, ],
veganCovEllipse(ellip[[g]]$cov, ellip[[g]]$center, ellip[[g]]$scale))), Genotype = g))
}
#B.compliment <- data.frame(x = -2.925, y = 2.4, labels = "(B)") # plot label
compliment <- ggplot(data = df_ell.cap.geno, aes(x = CAP1, y = CAP2, group = Genotype)) +
coord_fixed(ratio = 1) + #, xlim= c(-3.3,3.3)) + #xlim = c(-3,3.2)
geom_polygon(color = NA, fill = "gray50", alpha = 0.5) + # didn't use stat_ellipse because I wanted to plot standard errors instead of 95% confidence intervals
geom_text(data = centroids.cap.geno,
aes(x = CAP1, y = CAP2, label = Genotype), size = 2) +
#scale_x_continuous(limits = c(-3,2)) +
#geom_text(data = B.compliment, aes(x = x, y = y, label = labels),
#          inherit.aes = FALSE, size = 4) +
theme_bw() +
theme(axis.text.y = element_text(size = 6),#10
axis.text.x = element_text(size = 6),#10
axis.title.x = element_text(size = 8, vjust = 0.75),#vjust = 0.1,
axis.title.y = element_text(size = 8, vjust = 0.25),#vjust = 0.5,
panel.grid = element_blank(),
plot.margin = unit(c(0,0,0,0), "in"))
# adjust plot.margin
vp <- viewport(width = 0.35, height = 0.35, x = 0.75, y = 0.32) #viewport(width = 0.4, height = 0.4, x = 0.7, y = 0.35)
tiff("~/Documents/Genotype_Networks/figures/fig_6_complexity_complimentarity.tif", width = 3.42, height = 4, units = "in", res = 600)
print(total)
print(compliment, vp = vp)
dev.off() # turn o
vp <- viewport(width = 0.35, height = 0.35, x = 0.75, y = 0.32) #viewport(width = 0.4, height = 0.4, x = 0.7, y = 0.35)
tiff("~/Documents/Genotype_Networks/figures/fig_6_complexity_complimentarity.tiff", width = 3.42, height = 4, units = "in", res = 600)
print(total)
print(compliment, vp = vp)
dev.off() # turn off png device
web complexity (weighted linkage density)
total.labels <- paste(c(" ",1,5,10,15,20,25),
c("(1) "," (4)","(20)","(40)","(60)","(80)","(100)"), sep = "\n")
total <- ggplot(web.measures.summary,#all.measures,
aes(x = genotypes.sampled,
y = mean.complexity,# total_complexity,
group = genotypes.sampled)) +
#stat_summary(fun.y = mean, geom = "point", color = "grey",
#            shape = 1, size = 1.5) +
geom_jitter(color = "grey", shape = 1, position = position_jitter(width = 0.25, height = NULL), size = 1) +
stat_summary(fun.y = mean, geom = "point", color = "steelblue",
shape = 20, size = 3) +
#geom_line(data = full.nls.predict.df, aes(x = genotypes.sampled, y = mean.complexity),
# size = 1,
# color = "steelblue", inherit.aes = FALSE) +
#geom_boxplot(aes(group = genotypes.sampled),
#           notch = TRUE, outlier.shape = 1,
#          outlier.colour = "grey", fill = "steelblue") +
#geom_jitter(shape = 1,
#           color = "grey",
#          position = position_jitter(width = 0.25, height = NULL),
#         size = 1) +
#stat_summary(fun.y = mean, geom = "point", color = "steelblue", size = 3) +
#geom_boxplot(data = monos.summary,
#          aes(x = plants.sampled/4,
#             y = total_complexity.mean,
#            group = plants.sampled),
#       color = "black",
#      outlier.shape = NA,
#outlier.colour = "black",
#     inherit.aes = FALSE) +
geom_point(data = monos.summary.plot,
aes(x = plants.sampled/4,
y = total_complexity.mean),
color = "black", size = 1.5,
inherit.aes = FALSE) +
geom_line(data = monos.nls.predict,
aes(x = plants.sampled/4, y = total_complexity),
linetype = "dashed",
color = "black",
inherit.aes = FALSE) +
xlab("No. of willow genotypes (no. of plants)") +
ylab(bquote('Food-web complexity ('*italic(LD[q])*')')) +
scale_x_continuous(limits = c(0.1,25.5),
breaks = c(0.25,1,5,10,15,20,25),
labels = total.labels) +
scale_y_continuous(limits = c(1,2.45), #c(1,2.4)
breaks = seq(1, 2.25, by = 0.25)) +
theme_bw() +
theme(axis.text.y = element_text(size = 9),
axis.text.x = element_text(size = 6),#9
axis.title.x = element_text(size = 11, vjust = 0.1),
axis.title.y = element_text(size = 11, vjust = 0.5),
panel.grid = element_blank())
total
vp <- viewport(width = 0.35, height = 0.35, x = 0.75, y = 0.32) #viewport(width = 0.4, height = 0.4, x = 0.7, y = 0.35)
tiff("~/Documents/Genotype_Networks/figures/fig_6_complexity_complimentarity.tiff", width = 3.42, height = 4, units = "in", res = 600)
print(total)
print(compliment, vp = vp)
dev.off() # turn off png device
dim(all.measures)[1] # 216,102 unique simulations. 250,00 simulations originally run
