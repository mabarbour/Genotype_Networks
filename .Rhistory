select(vLG.height.mean, vLG.gall.count, Height:log_trichomes) %>%
na.omit()
gall.size.df$Height_resid = resid(lm(Height ~ log_size, gall.size.df))
gall.size.df$Density_resid = resid(lm(Density ~ log_size, gall.size.df))
gall.size.df$SLA_resid = resid(lm(specific_leaf_area ~ water_content, gall.size.df))
gall.size.df <- select(gall.size.df, vLG.height.mean, vLG.gall.count,
C_N_imputed, water_content,
sal_tannin.PC1:SLA_resid)
vLG.size.lm <- lm(vLG.height.mean ~ ., select(gall.size.df, -vLG.gall.count), weights = gall.size.df$vLG.gall.count)
drop1(vLG.size.lm)
size2 <- update(vLG.size.lm, .~. -C_N_imputed); drop1(size2)
size3 <- update(size2, .~. -Density_resid); drop1(size3)
size4 <- update(size3, .~. -flavonOLES.PC2); drop1(size4)
size5 <- update(size4, .~. -flavanonOLES.PC1); drop1(size5)
size6 <- update(size5, .~. -log_trichomes); drop1(size6)
size7 <- update(size6, .~. -SLA_resid); drop1(size7)
size8 <- update(size7, .~. -Height_resid); drop1(size8)
size9 <- update(size8, .~. -water_content); drop1(size9)
size10 <- update(size9, .~. -log_size); drop1(size10)
size11 <- update(size10, .~. -cinn.PC1); drop1(size11)
size12 <- update(size11, .~. -cinn.PC2); drop1(size12)
size13 <- update(size12, .~. -flavonOLES.PC1); drop1(size13)
size14.null <- update(size13, .~. -sal_tannin.PC1)
## use AIC to compare models
AIC.vLG.size.traits <- data.frame(Models = 1:14, # progressive order in which sizeels were fit
Formula = c(paste(formula(vLG.size.lm)[3]),
paste(formula(size2)[3]),
paste(formula(size3)[3]),
paste(formula(size4)[3]),
paste(formula(size5)[3]),
paste(formula(size6)[3]),
paste(formula(size7)[3]),
paste(formula(size8)[3]),
paste(formula(size9)[3]),
paste(formula(size10)[3]),
paste(formula(size11)[3]),
paste(formula(size12)[3]),
paste(formula(size13)[3]),
paste(formula(size14.null)[3])),
AIC = c(sum(AIC(vLG.size.lm)),
sum(AIC(size2)),
sum(AIC(size3)),
sum(AIC(size4)),
sum(AIC(size5)),
sum(AIC(size6)),
sum(AIC(size7)),
sum(AIC(size8)),
sum(AIC(size9)),
sum(AIC(size10)),
sum(AIC(size11)),
sum(AIC(size12)),
sum(AIC(size13)),
sum(AIC(size14.null))))
arrange(AIC.vLG.size.traits, AIC)
# all of these models give the same picture. Sal_tannin.PC1 and flavonOLES.PC1 are the best predictors.
summary(size11)
summary(size10)
summary(size12) # final model
summary(size9)
anova(size14.null, size13, size12, size11, size10, size9, size8, size7)
plot(size12) # residuals looks pretty good
# Iteomyia size decreased 1.2 fold over the range in flavonid chemistry
max(vLG.size.predict$flavonOLES.PC1$y$fit)/min(vLG.size.predict$flavonOLES.PC1$y$fit)
full.mvabund <- mvabund(full.df[ ,interaxns_noPont]) # create mvabund object for easy analysis
full.meanvar <- meanvar.plot(full.mvabund ~ full.df$Genotype, table = TRUE) # easy to see that the data do not have a poisson distribution, therefore, a negative binomial may be a good fit.
poisson_curve(from = 0.1, to = 3.0, color = "blue")
quasipoisson_curve(from = 0.1, to = 3.0, quasi.scalar = 2, color = "red")
neg.binomial_curve(from = 0.1, to = 3.0, theta.negbin = 0.7, color = "black") # negative binomial appears to provide the best fit to this relationship
#no.relationships <- which(names(colSums(full.mvabund)) %in% c("rG_Lestodip", "rG_Mesopol", "SG_Platy", "vLG_Eulo"))
#sum(colSums(full.mvabund)[no.relationships])/sum(colSums(full.mvabund)) # less than 13% of the links in the network had relationships to gall abundance and size (see results below)
full.predictors <- full.df %>%
select(aSG_Tory:rG_Platy, rG_Tory, SG_Platy, vLG_Eulo:vLG_Tory, # interactions
aSG_abund:vLG_abund, # gall counts. Exclusing SG_abund because it didn't vary among genotypes
Genotype, # keeping for later analysis
vLG.height.mean) %>% # Iteomyia gall size
# we transformed some of the variables so we could examine their vif
mutate(log.vLG_abund = log(vLG_abund),
log.1.vLG_abund = log(vLG_abund + 1),
log.1.rG_abund = log(rG_abund + 1),
log.1.aSG_abund = log(aSG_abund + 1),
log.vLG.height.mean = log(vLG.height.mean)) %>%
na.omit() # removes all instances that don't have vLG.height.mean
dim(full.predictors)[1] # 81 data points
net.trait <- mvabund(full.predictors[ ,interaxns_noPont])
net.mvabund.1.full <- manyglm(net.trait ~ log.vLG_abund*vLG.height.mean +
log.1.rG_abund + log.1.aSG_abund,
data = full.predictors,
family = "negative.binomial")
net.mvabund.2 <- update(net.mvabund.1.full, .~. - log.vLG_abund:vLG.height.mean)
drop1(net.mvabund.2)
anova.net <- anova.manyglm(net.mvabund.2, p.uni = "unadjusted") # takes about 2.5 min to run.
anova.net
size12
summary(size12)
str(gall.size.df)
str(full.df)
summary(lm(vLG.height.mean ~ luteolin.der2__A320nm, full.df, weights = gall.size.df$vLG.gall.count))
summary(lm(vLG.height.mean ~ luteolin.der2__A320nm, full.df, weights = full.df$vLG.gall.count))
gall.lins <- manylm(log(gall.mvabund+1) ~ Genotype, data = full.df)
gall.mvabund <- mvabund(full.df[ ,c("vLG_abund","rG_abund","aSG_abund","SG_abund")])
gall.lins <- manylm(log(gall.mvabund+1) ~ Genotype, data = full.df)
summary(gall.lins)
anova(gall.lins, p.uni = "unadjusted")
full.mvabund <- mvabund(full.df[ ,interaxns_noPont]) # create mvabund object for easy analysis
link.lins <- manylm(log(full.mvabund+1) ~ Genotype, data = full.df)
anova(link.lins, p.uni = "unadjusted")
summary(link.lins)
full.predictors <- full.df %>%
select(aSG_Tory:rG_Platy, rG_Tory, SG_Platy, vLG_Eulo:vLG_Tory, # interactions
aSG_abund:vLG_abund, # gall counts. Exclusing SG_abund because it didn't vary among genotypes
Genotype, # keeping for later analysis
vLG.height.mean) %>% # Iteomyia gall size
# we transformed some of the variables so we could examine their vif
mutate(log.vLG_abund = log(vLG_abund),
log.1.vLG_abund = log(vLG_abund + 1),
log.1.rG_abund = log(rG_abund + 1),
log.1.aSG_abund = log(aSG_abund + 1),
log.vLG.height.mean = log(vLG.height.mean)) %>%
na.omit() # removes all instances that don't have vLG.height.mean
dim(full.predictors)[1] # 81 data points
net.trait <- mvabund(full.predictors[ ,interaxns_noPont])
net.trait.lms <- manygm(net.trait ~ log.vLG_abund + vLG.height.mean +
log.1.rG_abund + log.1.aSG_abund,
data = full.predictors)
net.trait.lms <- manylm(net.trait ~ log.vLG_abund + vLG.height.mean +
log.1.rG_abund + log.1.aSG_abund,
data = full.predictors)
summary(net.trait.lms)
# selects galls and traits for analysis
galls.traits.df <- full.df %>%
select(aSG_abund:SG_abund,
vLG.height.mean, vLG.gall.count,
Trichome.No., Total_Area, Height, Density,
C_N_imputed, water_content, specific_leaf_area, sal_tannin.PC1:flavanonOLES.PC1)
# create some new variables to reduce multicollinearity among non-principal component traits
gall.density.df <- galls.traits.df %>%
mutate(log_size = log(Total_Area),
log_trichomes = log(Trichome.No.+1)) %>%
select(aSG_abund:SG_abund, Height:log_trichomes) %>%
na.omit()
gall.density.df$Height_resid = resid(lm(Height ~ log_size, gall.density.df))
gall.density.df$Density_resid = resid(lm(Density ~ log_size, gall.density.df))
gall.density.df$SLA_resid = resid(lm(specific_leaf_area ~ water_content, gall.density.df))
# subset the final datasets
galls_galls.traits <- mvabund(select(gall.density.df, aSG_abund:SG_abund))
traits_galls.traits <- select(gall.density.df, C_N_imputed, water_content, sal_tannin.PC1:SLA_resid)
mvabund.galls.traits <- manyglm(galls_galls.traits ~ C_N_imputed + water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid,
data = traits_galls.traits,
family = "negative.binomial")
plot(mvabund.galls.traits, which = 1:3)
gall.trait.lms <- manylm(galls_galls.traits ~ C_N_imputed + flavanonOLES.PC1 + log_size,
data = traits_galls.traits)
summary(gall.trait.lms)
anova(gall.trait.lms, p.uni = "unadjusted")
data = traits_galls.traits))
best.r.sq(manylm(galls_galls.traits ~ C_N_imputed + water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid,
data = traits_galls.traits))
best.r.sq(galls_galls.traits ~ C_N_imputed + water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid, data = traits_galls.traits)
traits_galls.traits
galls_galls.traits
best.r.sq(galls_galls.traits ~ C_N_imputed + water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid, data = traits_galls.traits)
best.r.sq(galls_galls.traits ~ water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid, data = traits_galls.traits)
galls.mvformula <- mvformula(galls_galls.traits ~ C_N_imputed + water_content + sal_tannin.PC1 + cinn.PC1 + cinn.PC2 + flavonOLES.PC1 + flavonOLES.PC2 + flavanonOLES.PC1 + log_size + log_trichomes + Height_resid + Density_resid + SLA_resid)
is.mvformula(galls.mvformula)
galls.mvformula
best.r.sq(galls.mvformula, data = traits_galls.traits)
best.r.sq(galls_galls.traits ~ ., data = traits_galls.traits)
best.r.sq(galls_galls.traits ~ ., data = traits_galls.traits)
best.r.sq(galls_galls.traits ~ traits_galls.traits$C_N_imputed + traits_galls.traits$water_content + traits_galls.traits$sal_tannin.PC1 + traits_galls.traits$cinn.PC1 + traits_galls.traits$cinn.PC2 + traits_galls.traits$flavonOLES.PC1 + traits_galls.traits$flavonOLES.PC2 + traits_galls.traits$flavanonOLES.PC1 + traits_galls.traits$log_size + traits_galls.traits$log_trichomes + traits_galls.traits$Height_resid + traits_galls.traits$Density_resid + traits_galls.traits$SLA_resid)
source('~/Documents/Genotype_Networks/Rscripts/network_management_tree_level.R')
source('~/Documents/miscellaneous_R/ggplot_themes.R')
source('~/Documents/ggnet/bipartite_plot_info.R')
require(ggplot2)
require(gridExtra)
require(dplyr)
require(tidyr)
## create theme for figures
theme_links <- theme_bw() +
theme(axis.title.x = element_text(size = 16, vjust = 0.1),
axis.title.y = element_text(size = 16, vjust = 1),
axis.text = element_text(size = 14),
strip.text = element_text(size = 14),
panel.grid = element_blank(),
legend.position = "none")
point.size.range <- c(1,8)
label.x.pos <- 1.5
label.y.galls <- 23
label.y.gallsize <- 14
label.y.ptoids <- 9.5
label.y.ptism <- 1
ABCD.allgalls <- data.frame(x = rep(label.x.pos,4), y = rep(label.y.galls,4),
variable = c("Leaf gall", "apical-Stem gall",
"Bud gall", "mid-Stem gall"),
labels = c("(A)","(B)","(C)","(D)"))
AB.domgalls <- data.frame(x = rep(label.x.pos,2), y = rep(label.y.galls,2),
variable = c("Leaf gall","Bud gall"),
labels = c("(A)","(B)"))
C.gallsize <- data.frame(x = label.x.pos, y = label.y.gallsize, labels = "(C)")
ABC.domptoids <- data.frame(x = rep(label.x.pos,3), y = rep(label.y.ptoids,3),
Parasitoid = c("Platygaster", "Mesopolobus", "Torymus"),
labels = c("(A)","(B)","(C)"))
D.ptism <- data.frame(x = label.x.pos, y = label.y.ptism, labels = "(D)")
A.linkabund <- data.frame(x = 0.5, y = 10, labels = "(A)")
B.ptism <- data.frame(x = 4.25, y = label.y.ptism, labels = "(B)")
#point.size <- 6
line.widths <- 3 # for link plots
## create color-blind friendly palette with grey (taken from http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/)
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
## change Genotype * to C for plotting aesthetics
levels(tree_level_interaxn_all_plants_traits_size$Genotype)[1] <- "C"
attack.df <- as.data.frame(tree_level_interaxn_all_plants_traits_size) %>%
filter(vLG.height.mean > 0) %>%
#mutate(vLG_Platy.prop = vLG_Platy/vLG_abund,
#      vLG_Mesopol.prop = vLG_Mesopol/vLG_abund,
#     vLG_Tory.prop = vLG_Tory/vLG_abund) %>%
select(vLG.height.mean, vLG_abund, vLG_Platy, vLG_Mesopol, vLG_Tory) %>%
gather(vLG.height.mean, vLG_abund)
attack.df$cut.vLG_abund <- cut(attack.df$vLG_abund, breaks = c(1, 4, 22), include.lowest = TRUE, labels = c("Low leaf gall abundance (1-4 per branch)", "High leaf gall abundance (5 - 22 per branch)"))
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_point(alpha = 0.5) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_point(alpha = 0.75) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_point(alpha = 0.75, size = 5) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_point(alpha = 0.5, size = 5) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.5, size = 5, position = position_jitter(height = 0.05, width = 0)) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.5, size = 5, position = position_jitter(height = 0.01, width = 0)) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5, position = position_jitter(height = 0.01, width = 0)) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) + #+
#geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
B.ptism
AB.ptism <- data.frame(x = rep(4.25,2), y = rep(1,2), labels = c("(A)","(B)"))
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_wrap(~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels),
inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_grid(. ~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels),
inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(vLG_ptized.df.3, aes(x = Genotype, y = vLG_prop.ptized,
size = vLG_abund, fill = type, color = type, shape = type)) +
geom_point() +
scale_shape_manual(values = c(1, 23)) +
scale_color_manual(values = c(cbPalette[1], "black")) +
scale_size(range = point.size.range) +
scale_fill_manual(values = cbPalette[c(1,7)]) +
geom_text(data = D.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
ylab("Proportion of leaf galls parasitized") + xlab("") +
theme_links
## calculated the weighted mean of leaf gall parasitism on each genotype. I used the number of galls sampled on each replicate willow as the weight, because these will have a more reliable estimate of mean gall size for that willow.
vLG_ptized.df.2 <- vLG_ptized.df %>%
group_by(Genotype) %>%
summarise(vLG_prop.ptized = weighted.mean(vLG_prop.ptized, vLG_abund,
na.rm = TRUE),
vLG_abund = 15) %>% # point size to use for plotting
mutate(type = "weighted.mean")
## bind the original and summarized data together, then order the genotypes according to median leaf gall abundance
vLG_ptized.df.3 <- rbind.data.frame(vLG_ptized.df.2, vLG_ptized.df)
vLG_ptized.df.3$Genotype <- factor(vLG_ptized.df.3$Genotype, levels = vLG.df.sum$Genotype)
## tidy up the data for visualizing the differences in leaf gall parasitism among willow genotypes.
vLG_ptized.df <- as.data.frame(tree_level_interaxn_all_plants_traits_size) %>%
mutate(vLG_ptized = vLG_Platy + vLG_Tory + vLG_Mesopol + vLG_Eulo + vLG_Mymarid) %>%
mutate(vLG_prop.ptized = vLG_ptized/vLG_abund, type = "mean") %>%
select(Genotype, vLG_prop.ptized, vLG_abund, type)
glm.vLG_ptized <- glm(vLG_prop.ptized ~ Genotype, data = vLG_ptized.df, weights = vLG_abund, family = "quasibinomial")
summary(glm.vLG_ptized)
anova(glm.vLG_ptized, test = "F")
## calculated the weighted mean of leaf gall parasitism on each genotype. I used the number of galls sampled on each replicate willow as the weight, because these will have a more reliable estimate of mean gall size for that willow.
vLG_ptized.df.2 <- vLG_ptized.df %>%
group_by(Genotype) %>%
summarise(vLG_prop.ptized = weighted.mean(vLG_prop.ptized, vLG_abund,
na.rm = TRUE),
vLG_abund = 15) %>% # point size to use for plotting
mutate(type = "weighted.mean")
## bind the original and summarized data together, then order the genotypes according to median leaf gall abundance
vLG_ptized.df.3 <- rbind.data.frame(vLG_ptized.df.2, vLG_ptized.df)
vLG_ptized.df.3$Genotype <- factor(vLG_ptized.df.3$Genotype, levels = vLG.df.sum$Genotype)
## plot leaf gall parasitism among willow genotypes. Size of points correspond to weights used to calculated the weighted mean of leaf gall parasitism for each genotype.
vLG_ptized.plot <- ggplot(vLG_ptized.df.3, aes(x = Genotype, y = vLG_prop.ptized,
size = vLG_abund, fill = type, color = type, shape = type)) +
geom_point() +
scale_shape_manual(values = c(1, 23)) +
scale_color_manual(values = c(cbPalette[1], "black")) +
scale_size(range = point.size.range) +
scale_fill_manual(values = cbPalette[c(1,7)]) +
geom_text(data = D.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
ylab("Proportion of leaf galls parasitized") + xlab("") +
theme_links
ggplot(vLG_ptized.df.3, aes(x = Genotype, y = vLG_prop.ptized,
size = vLG_abund, fill = type, color = type, shape = type)) +
geom_point() +
scale_shape_manual(values = c(1, 23)) +
scale_color_manual(values = c(cbPalette[1], "black")) +
scale_size(range = point.size.range) +
scale_fill_manual(values = cbPalette[c(1,7)]) +
geom_text(data = D.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
ylab("Proportion of leaf galls parasitized") + xlab("") +
theme_links
ggplot(filter(link.df, Gall == "Leaf gall",
Parasitoid %in% c("Platygaster", "Mesopolobus", "Torymus")),
aes(x = Genotype, y = value, fill = Parasitoid)) +
facet_grid(Parasitoid ~ Gall) +
geom_boxplot() +
geom_text(data = ABC.domptoids, aes(x = x, y = y, label = labels)) +
scale_fill_manual(values = cbPalette[c(6,4,2)]) +
scale_y_continuous(limits = c(0,10), breaks = seq(0,10,2)) +
ylab("Link abundance (#/branch)") + xlab("") +
theme_links
## tidy up data for visualizing differences in link composition among genotypes.
link.df <- as.data.frame(tree_level_interaxn_all_plants_traits_size) %>%
select(Genotype,
vLG_Platy, vLG_Mesopol, vLG_Tory, vLG_Eulo, vLG_Mymarid,
rG_Tory, rG_Eulo, rG_Platy, rG_Mesopol, rG_Lestodip, rG_Mesopol,
aSG_Tory, SG_Platy) %>%
gather(Genotype) %>%
separate(variable, into = c("Gall", "Parasitoid"), sep = "_")
## revalue link composition data from species codes to common/species names
link.df$Gall <- factor(revalue(link.df$Gall, c("vLG" = "Leaf gall",
"rG" = "Bud gall",
"aSG" = "apical-Stem gall",
"SG" = "mid-Stem gall")))
link.df$Gall <- factor(link.df$Gall, levels = c("Leaf gall", "Bud gall", "apical-Stem gall", "mid-Stem gall"))
link.df$Parasitoid <- factor(revalue(link.df$Parasitoid, c("Platy" = "Platygaster",
"Mesopol" = "Mesopolobus",
"Tory" = "Torymus",
"Eulo" = "Eulophid",
"Lestodip" = "Lestodiplosis",
"Mymarid" = "Mymarid")))
link.df$Parasitoid <- factor(link.df$Parasitoid, levels = c("Platygaster",
"Mesopolobus",
"Torymus",
"Eulophid",
"Lestodiplosis",
"Mymarid"))
## order genotypes by mean leaf gall abundance
link.df$Genotype <- factor(link.df$Genotype, levels = vLG.df.sum$Genotype)
## link summary
link.summary <- link.df %>% group_by(Genotype, Gall, Parasitoid) %>% summarise_each(funs(mean)) %>% arrange(Gall)
max(filter(link.summary, Gall == "Leaf gall", Parasitoid == "Platygaster")$value) # 3.7
max(filter(link.summary,  Gall == "Leaf gall", Parasitoid == "Mesopolobus")$value) # 8
max(filter(link.summary,  Gall == "Leaf gall", Parasitoid == "Torymus")$value) # 1.4
## link composition plot for all possible interactions. For supplementary materials.
link.composition.plot <- ggplot(link.df, aes(x = Genotype, y = value, fill = Parasitoid)) +
facet_grid(Parasitoid ~ Gall) +
geom_boxplot() +
scale_fill_manual(values = c(cbPalette[c(6,4,2,5,1)], "black")) +
scale_y_continuous(limits = c(0,10), breaks = seq(0,10,2)) +
ylab("Link abundance (#/branch)") +
theme_links
ggplot(link.df, aes(x = Genotype, y = value, fill = Parasitoid)) +
facet_grid(Parasitoid ~ Gall) +
geom_boxplot() +
scale_fill_manual(values = c(cbPalette[c(6,4,2,5,1)], "black")) +
scale_y_continuous(limits = c(0,10), breaks = seq(0,10,2)) +
ylab("Link abundance (#/branch)") +
theme_links
ggplot(filter(link.df, Gall == "Leaf gall",
Parasitoid %in% c("Platygaster", "Mesopolobus", "Torymus")),
aes(x = Genotype, y = value, fill = Parasitoid)) +
facet_grid(Parasitoid ~ Gall) +
geom_boxplot() +
geom_text(data = ABC.domptoids, aes(x = x, y = y, label = labels)) +
scale_fill_manual(values = cbPalette[c(6,4,2)]) +
scale_y_continuous(limits = c(0,10), breaks = seq(0,10,2)) +
ylab("Link abundance (#/branch)") + xlab("") +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_grid(. ~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels)) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
str(attack.df)
data.frame(x = rep(4.25,2), y = rep(1,2),
labels = c("(A)","(B)"), variable = c("vLG_Platy","vLG_Mesopol","vLG_Tory"))
ggplot(filter(link.df, Gall == "Leaf gall",
Parasitoid %in% c("Platygaster", "Mesopolobus", "Torymus")),
aes(x = Genotype, y = value, fill = Parasitoid)) +
facet_grid(Parasitoid ~ Gall) +
geom_boxplot() +
geom_text(data = ABC.domptoids, aes(x = x, y = y, label = labels)) +
scale_fill_manual(values = cbPalette[c(6,4,2)]) +
scale_y_continuous(limits = c(0,10), breaks = seq(0,10,2)) +
ylab("Link abundance (#/branch)") + xlab("") +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_point(aes(size = vLG_abund), alpha = 0.5) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = B.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_grid(. ~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels)) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
attack.df
AB.ptism <- data.frame(x = rep(4.25,2), y = rep(1,2),
labels = c("(A)","(B)"), cut.vLG_abund = c("Low leaf gall abundance (1-4 per branch)", "High leaf gall abundance (5 - 22 per branch)"))
#point.size <- 6
attack.df$cut.vLG_abund <- cut(attack.df$vLG_abund, breaks = c(1, 4, 22), include.lowest = TRUE, labels = c("Low leaf gall abundance (1-4 per branch)", "High leaf gall abundance (5 - 22 per branch)"))
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_grid(. ~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels)) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
ggplot(attack.df, aes(x = vLG.height.mean, y = value/vLG_abund,
color = variable, shape = variable, linetype = variable)) +
geom_jitter(alpha = 0.25, size = 5,
position = position_jitter(height = 0.01, width = 0)) +
facet_grid(. ~ cut.vLG_abund) +
geom_smooth(method = "glm", family = binomial,
aes(weight = vLG_abund), se = FALSE, size = line.widths) +
geom_text(data = AB.ptism, aes(x = x, y = y, label = labels), inherit.aes = FALSE) +
xlab("Leaf gall diameter (mm)") + ylab("Proportion of leaf galls parasitized") +
scale_color_manual(values = cbPalette[c(6,4,2)]) +
theme_links
